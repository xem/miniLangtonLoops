<canvas id=a width=400 height=400>
<script>
c=a.getContext`2d`

/* golf starts here */

// map
m=[];

// Initial state

/*---------------------

s = [
  "022222222",
  "2170140142",
  "2022222202",
  "2720000212",
  "2120000212",
  "2020000212",
  "2720000212",
  "21222222122222",
  "207107107111112",
  "02222222222222"
];

---------------------*/

s="0222222229217014014292022222202927200002129212000021292020000212927200002129212222221222229207107107111112902222222222222".split(9);


// Rules
// (Ignoring all the rules that don't change the current color of a cell)

/* ---------------------

r = [
  "000012", "000063", "000071", "000112", "000122", "000132", "000212", "000262", "000272", "000525", "000622", "000722", "001022", "002125", "002322", "005222", "012321", "012421", "012525", "012621", "012721", "012751", "014221", "014321", "014421", "014721", "016251", "017221", "017255", "017521", "017621", "017721", "025271", "100077", "100244", "100277", "101244", "101277", "102026", "102244", "102263", "102277", "102327", "102424", "102626", "102644", "102677", "102710", "102727", "105427", "111244", "111277", "111522", "112244", "112277", "112424", "112727", "122244", "122277", "122434", "122547", "123244", "123277", "124255", "124267", "125275", "200071", "200250", "200326", "200423", "200517", "200575", "202073", "202321", "202520", "203216", "203226", "205521", "205725", "211261", "300022", "300041", "300076", "300421", "300622", "301021", "301220", "302511", "401120", "401220", "401250", "402120", "402221", "402326", "402520", "403221", "500022", "500232", "500272", "500520", "502022", "502122", "502152", "502220", "502244", "502722", "512122", "512220", "512422", "512722", "600011", "600021", "602120", "612125", "612131", "612225", "701120", "701220", "701250", "702120", "702221", "702251", "702321", "702525", "702720"
];

-----------------------*/
z=120;
r=[];
q="c,1r,1z,34,3e,3o,5w,7a,7k,el,ha,k2,se,1n1,1si,412,9i9,9l1,9nx,9ql,9td,9u7,az1,b1t,b4l,bcx,cjf,dad,dbb,dip,dlh,do9,jhz 25,6s,7p,yk,zh,1ka,1qc,1qv,1r9,1sn,1vc,20y,21g,22d,23a,23r,46r,8oc,8p9,8w2,9g4,9h1,9l4,9tj,h5w,h6t,hb6,heb,hxo,hyl,ipr,iq3,ji3 1z,6y,92,br,ed,fz,1ll,1sh,1y0,2hc,2hm,49d,4f1,8ot m,15,24,bp,ha,sd,xw,1xr v4,xw,yq,1mw,1pp,1sm,1y0,2hh m,6g,7k,eg,1k6,1my,1ns,1po,1qc,23m,9cq,9fg,9l2,9te b,l,1mw,9ct,9cz,9fl v4,xw,yq,1mw,1pp,1qj,1sh,1y5,23k".split` `;
for(i in q)
  for(j in q[i]=q[i].split`,`,q[i]){
    q[i][j]=(i+("00000"+parseInt(q[i][j],36)).slice(-5)).split``;
    for(k in q[i][j])
      q[i][j][k]=+q[i][j][k];
    r.push(q[i][j].join``)
  }


// Loop
L=function(){
  
  // New map
  n=[];
  
  // for each line
  for(j=0;250>j;j++)
    
    // For each cell
    for(n[j]=[],i=0;250>i;i++){
      
      // 1st generation: draw initial state
      if(z){
        n[j][i]=s[j-z]&&s[j-z][i-z]?+s[j-z][i-z]:0
      }
      
      // Next generations: apply the rules
      else{
      
        // Reuse previous color by default, then:
        n[j][i]=m[j][i];
        
        // For better berfs, ignore cells with black neighbours
        N=m[j-1]?m[j-1][i]:0;
        E=m[j][i+1]||0;
        S=m[j+1]?m[j+1][i]:0;
        W=m[j][i-1]||0;
        if(N+E+S+W){
        
          // for each rule, test if the current cell is equal to the first char of the rule, and if the 4 neighbour cells are present in any rotation of the chars 2 to 5 of the rule, and if all of this is true, set the last char of the rule as the current cell's color
          for(k=0;k<r.length;k++)
            r[k][0]==m[j][i]&&~(r[k].substr(1,4)+r[k].substr(1,4)).indexOf(""+N+E+S+W)&&(n[j][i]=r[k][5])
        }
      }
      
      // Draw the cells that have chaned colors
      if(z||n[j][i]!=m[j][i])
        c.fillStyle="#"+"000FFF0F00".substr("01764532"[n[j][i]],3),
        c.fillRect(2*i-50,2*j-50,2,2)
    }
  m=n;
  z=0
  setTimeout(L,33);
}
L();
</script>